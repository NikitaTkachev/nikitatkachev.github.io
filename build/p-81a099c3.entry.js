import{r as t,h as e,H as s}from"./p-5025e2d0.js";import"./p-f355a6e5.js";import"./p-c5a29178.js";import"./p-d6720089.js";import{a as o,t as i}from"./p-3e6ea101.js";const a={BOOKED:{type:"success",header:"Good job!",message:"Your seat has been successfully booked"},BUSY:{type:"error",header:"Bad news :(",message:"This seat has been already booked"},OFFLINE:{type:"error",header:"Off-line mode",message:"Connection has been lost. When it recovers, we will repeat your request."}},n=class{constructor(e){t(this,e),this.url="https://cinema-booking-pwa-app.herokuapp.com",this.seats=[],this.picked=0}async getSeats(){const t=await fetch(this.url+"/seats",{method:"GET"}),e=await t.json();this.seats=e,this.picked=0}bookSeatById(){fetch(`${this.url}/seats/book/${this.picked}`,{method:"PUT"}).then((t=>{if(!t.ok)throw new Error(t.statusText);return t.json()})).then((()=>{this.presentAlert(a.BOOKED),this.getSeats()})).catch((t=>{"Conflict"===t.message&&(this.presentAlert(a.BUSY),this.getSeats()),"Failed to fetch"===t.message&&this.presentAlert(a.OFFLINE)}))}async resetAllSeats(){this.seats=await fetch(this.url+"/seats/reset",{method:"PUT"}).then((t=>t.json())),this.picked=0}async presentAlert({type:t,header:e,message:s}){this.alert&&(await this.alert.dismiss(),this.alert=null),this.alert=await o.create({cssClass:"alert-"+t,header:e,message:s,buttons:["OK"]}),await this.alert.present()}async presentNetworkStateToast(){this.toast&&(await this.alert.dismiss(),this.toast=null),this.toast=await i.create({message:"Connection has been lost"}),await this.toast.present()}async dismissNetworkStateToast(){this.toast&&(await this.toast.dismiss(),this.toast=null)}componentDidLoad(){window.addEventListener("online",(()=>this.dismissNetworkStateToast())),window.addEventListener("offline",(()=>this.presentNetworkStateToast())),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",(({data:t})=>{this.presentAlert(t.ok?a.BOOKED:a.BUSY),this.getSeats()})),this.getSeats()}pickSeat(t){this.picked=t}render(){return e(s,null,e("ion-header",null,e("ion-toolbar",{color:"primary"},e("ion-title",null,"Cinema Booking App"))),e("ion-content",{class:"ion-padding"},e("ion-row",null,this.seats.map((t=>e("ion-col",{size:"2"},e("ion-button",{expand:"block",size:"large",color:"medium",fill:t.id===this.picked?"outline":"solid",disabled:t.isBooked,onClick:()=>this.pickSeat(t.id)},t.id))))),e("ion-row",null,e("ion-col",null,e("ion-button",{expand:"block",color:"primary",disabled:0===this.picked,onClick:()=>this.bookSeatById()},"Book"))),e("ion-row",null,e("ion-col",null,e("ion-button",{expand:"block",color:"light",onClick:()=>this.resetAllSeats()},"Reset all seats")))))}};n.style=".alert-success .alert-wrapper{background-color:#e0ffe0 !important}.alert-error .alert-wrapper{background-color:#ffdcdc !important}";export{n as app_home}